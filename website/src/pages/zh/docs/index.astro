---
import DocsLayout from '../../../layouts/DocsLayout.astro';
---

<DocsLayout title="快速入门">
  <h1>快速入门</h1>

  <p>Avalon 是一个用 Rust 编写的高性能反向代理服务器，基于 Cloudflare 的 Pingora 框架。它提供自动 HTTPS、负载均衡、URL 重写等功能。</p>

  <h2>安装</h2>

  <h3>从源码编译</h3>

  <pre><code># 克隆仓库
git clone https://github.com/neomody77/avalon.git
cd avalon

# 编译 release 版本
cargo build --release

# 可执行文件在 target/release/avalon</code></pre>

  <h3>使用 Docker</h3>

  <pre><code>docker build -t avalon .
docker run -p 80:80 -p 443:443 -v ./avalon.toml:/app/avalon.toml avalon</code></pre>

  <h2>最小配置</h2>

  <p>创建 <code>avalon.toml</code> 配置文件：</p>

  <pre><code># 全局设置
[global]
log_level = "info"

# TLS 设置 (可选)
[tls]
acme_enabled = false

# 服务器配置
[[servers]]
name = "web"
listen = [":8080"]

# 路由规则
[[servers.routes]]
[servers.routes.match]
path = ["/"]

[servers.routes.handle]
type = "static_response"
status = 200
body = "Hello, Avalon!"

[servers.routes.handle.headers]
Content-Type = "text/plain"</code></pre>

  <h2>运行</h2>

  <pre><code>./target/release/avalon --config avalon.toml</code></pre>

  <p>访问 <code>http://localhost:8080</code> 即可看到响应。</p>

  <h2>常用场景</h2>

  <h3>1. 反向代理</h3>

  <p>将请求转发到后端服务：</p>

  <pre><code>[[servers]]
name = "api-proxy"
listen = [":8080"]

[[servers.routes]]
[servers.routes.match]
path = ["/api"]

[servers.routes.handle]
type = "reverse_proxy"
upstreams = ["127.0.0.1:3000"]</code></pre>

  <h3>2. 多后端负载均衡</h3>

  <pre><code>[[servers.routes]]
[servers.routes.handle]
type = "reverse_proxy"
upstreams = ["127.0.0.1:3001", "127.0.0.1:3002", "127.0.0.1:3003"]
load_balancing = "round_robin"  # 可选: random, least_conn, ip_hash</code></pre>

  <h3>3. 静态文件服务</h3>

  <pre><code>[[servers.routes]]
[servers.routes.match]
path = ["/static"]

[servers.routes.handle]
type = "file_server"
root = "/var/www/static"
browse = false
index = ["index.html"]</code></pre>

  <h3>4. 自动 HTTPS (Let's Encrypt)</h3>

  <pre><code>[tls]
email = "admin@example.com"
acme_enabled = true
storage_path = "./certs"

[[servers]]
name = "https-server"
listen = [":443"]

[[servers.routes]]
[servers.routes.match]
host = ["example.com"]
path = ["/"]

[servers.routes.handle]
type = "reverse_proxy"
upstreams = ["127.0.0.1:3000"]</code></pre>

  <h3>5. HTTP 重定向到 HTTPS</h3>

  <pre><code>[[servers]]
name = "http-redirect"
listen = [":80"]
https_redirect = true</code></pre>

  <h2>配置热重载</h2>

  <p>Avalon 支持配置热重载。修改配置文件后，发送 SIGHUP 信号：</p>

  <pre><code>kill -HUP $(pidof avalon)</code></pre>

  <h2>下一步</h2>

  <ul>
    <li><a href="/zh/docs/configuration">配置参考</a> - 完整的配置选项说明</li>
    <li><a href="/zh/docs/examples">示例</a> - 更多配置示例</li>
    <li><a href="/zh/docs/rhai">Rhai 脚本</a> - 高级 URL 重写功能</li>
  </ul>
</DocsLayout>
